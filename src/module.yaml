parameters:
  service_bus.transport.amqp.dsn: ~
  service_bus.transport.amqp.qos_size: ~
  service_bus.transport.amqp.qos_count: ~
  service_bus.transport.amqp.qos_global: ~
  service_bus.transport.amqp.default_destination_topic: ~
  service_bus.transport.amqp.default_destination_key: ~

services:

  # Default transport level destination
  ServiceBus\Transport\Common\DeliveryDestination:
    class: ServiceBus\Transport\Amqp\AmqpTransportLevelDestination
    arguments:
      $exchange: '%service_bus.transport.amqp.default_destination_topic%'
      $routingKey: '%service_bus.transport.amqp.default_destination_key%'

  # RabbitMQ connection DSN
  ServiceBus\Transport\Amqp\AmqpConnectionConfiguration:
    arguments:
      $connectionDSN: '%service_bus.transport.amqp.dsn%'

  # RabbitMQ QoS settings
  ServiceBus\Transport\Amqp\AmqpQoSConfiguration:
    arguments:
      $size: '%service_bus.transport.amqp.qos_size%'
      $count: '%service_bus.transport.amqp.qos_count%'
      $global: '%service_bus.transport.amqp.qos_global%'

  # RabbitMQ transport implementation
  ServiceBus\Transport\Common\Transport:
    class: ServiceBus\Transport\Amqp\PhpInnacle\PhpInnacleTransport
    arguments:
      $connectionConfig: '@ServiceBus\Transport\Amqp\AmqpConnectionConfiguration'
      $qosConfig: '@ServiceBus\Transport\Amqp\AmqpQoSConfiguration'
      $logger: '@service_bus.logger'
